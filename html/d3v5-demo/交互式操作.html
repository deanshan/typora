<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <title>Document</title>
  <style>
    body {
      text-align: center;
    }
    .axis path,
    .axis line{
      fill: none;
      stroke: black;
      shape-rendering: crispEdges;
    }

    .axis text {
      font-family: sans-serif;
      font-size: 11px;
    }

    .text {
      fill: #000;
      text-anchor: middle;
    }

  </style>
</head>
<body>
  <p>注：此图基于d3-v5版本</p>
</body>
</html>
<script src="https://d3js.org/d3.v5.min.js" charset="utf-8"></script>
<script>
let width = 960,
    height = 560,
    padding = 20 // 画布内边距
//  创建svg画布
let svg = d3.select('body')
            .append('svg')
            .attr('width', width)
            .attr('height', height)
            .style('background', '#ccc')

// 数据集
let dataset = [10,20,30,23,13,40,27,35,20]
//x轴比例尺(序数)
let xScale = d3.scaleBand()
               .domain(d3.range(dataset.length))
               .rangeRound([0, width - 2 * padding])
//y轴比例尺(线性)
let yScale = d3.scaleLinear()
               .domain([0, d3.max(dataset)])
               .range([height - 2 * padding, 0])
//坐标轴
let xAxis = d3.axisBottom(xScale)
let yAxis = d3.axisLeft(yScale)

//矩形之间的间距
let space = 20
//添加矩形元素
let rect = svg.selectAll('rect')
              .data(dataset)
              .enter()
              .append('rect')
              .attr('transform', 'translate(' + 2 * padding + "," + padding/2 + ')')
              .attr('x', function (d, i) {
                return xScale(i) + space / 2
              })
              .attr('y', function (d, i) {
                return yScale(yScale.domain()[0])
              })
              .attr('width', xScale.step() - space)
              .attr('height', function (d, i) {
                return 0
              })
              .attr('fill', function () {
                return "hsl(" + Math.random() * 360 + ",100%,50%)"
              })
              .transition()//添加过渡效果
              .duration(2000)
              .delay(function (d, i) {
                return i * 400
              })
              // .ease(d3.easeElasticInOut)//chrome会报错
              .attr('y', function (d, i) {
                return yScale(d)
              })
              .attr('height', function (d, i) {
                return height - 2 * padding - yScale(d)
              })
//添加过渡效果（注：元素在添加时使用了过渡，后面的链式再调用transition会冲突报错
let rectTransition = svg.selectAll('rect')
                    .on('mouseover', function () {
                      d3.select(this).transition().duration(1000).attr('fill', 'yellow')
                    })
                    .on('mouseout', function () {
                      d3.select(this).transition().duration(1000).attr('fill', 'red')
                    })
//添加文字元素
let text = svg.selectAll('.text')
              .data(dataset)
              .enter()
              .append('text')
              .attr('class', 'text')
              .attr('transform', 'translate(' + 2 * padding + "," + padding/2 + ')')
              .attr("x", function(d,i){
                  return xScale(i) + space / 2
              })
              .attr("y",function(d){
                  return yScale(yScale.domain()[0])
              })
              .attr("dx",function(d,i){
                  return (xScale.step() - space) / 2
              })
              .attr("dy",function(d){
                  return 20
              })
              .text(function(d){
                  return d
              })
              .transition()
              .duration(2000)
              .delay(function (d, i) {
                return i * 400
              })
              .attr("y",function(d){
                  return yScale(d)
              })

//svg中添加x坐标
svg.append('g')
   .attr('class', 'axis')
   .attr("transform","translate(" + padding*3/2 + "," + (height - padding*3/2) + ")")
   .call(xAxis)

//svg添加y轴
svg.append("g")
  .attr("class","axis")
  .attr("transform","translate(" + padding*3/2 + "," + padding/2 + ")")
  .call(yAxis)
</script>
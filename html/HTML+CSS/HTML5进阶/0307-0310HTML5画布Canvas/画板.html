<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<title>画板</title>
	<style>
		main {
			width: 800px;
			height: 600px;
			margin: 10px auto;
		}
		#canvas {
			background: #ccc;
		}
	</style>
</head>
<body>
	<main>
	<!-- 画板功能 -->
		<div id="select">
			<button id="pen">铅笔</button>
	        <button id="line">直线</button>
	        <button id="rect">矩形</button>
	        <button id="arc">圆形</button>
	        <button id="robber">橡皮檫</button>
	        <button id="img">图片</button>
	        <button id="save">保存</button>
	        <input type="file" id="file" name="img" style="display: none"/>
	        <input type="color" id="color"/>
	        <input type="number" id="lineWidth"/>
		</div>
	<!-- 画板 -->
		<canvas id="canvas" width="800" height="500"></canvas>
	</main>
</body>
</html>
<script type="text/javascript" src="jquery-1.12.4.min.js"></script>
<script type="text/javascript">

	// 构造类，存储初始化参数
	function Draw() {
		this.type = 'pen';//选项类型，默认为铅笔
		this.pen = $('#canvas')[0].getContext("2d");
		this.img = new Image();//用于动态绘制直线，矩形，圆形
		this.isDraw = false;//绘画开关
	}
	var draw = new Draw();

	$('#select').on('click',function (e) {
		switch(e.target.id) {
			case 'pen' : draw.type = 'pen' ; break;
			case 'line' : draw.type = 'line' ; break;
			case 'rect' : draw.type = 'rect' ; break;
			case 'arc' : draw.type = 'arc' ; break;
			case 'robber' : draw.type = 'robber' ; break;
		}
		if (e.target.id == 'img') {
			$('#file')
				.click()//当点击图片按钮时，默认触发选择文件操作
				.change(function () {
					// 实例化 FileReader 对象
					var reader = new FileReader();
					// 以DataURL格式读取文件内容
					reader.readAsDataURL(this.files[0]);
					//文件读取完毕后触发操作
					reader.onload = function (e) {
						var img = new Image();
						img.src = this.result;
						draw.pen.drawImage(img,0,0);
					}
				})
		}
		if (e.target.id == 'save') {
			var a = $('<a>download</a>')
				.attr({
					herf: $('#canvas')[0].toDataURL('image/png'),//把画布转化为base64
					id : 'download',
					download: 'image.jpeg'
				})
				.appendTo('body')
				.hide()
				.click()
		}
	})
	$('#canvas').on('mousedown' ,function (e) {
		// console.log(e)
		draw.isDraw = true;
		draw.pen.strokeStyle = '#000';
		draw.pen.moveTo(e.offsetX,e.offsetY);
		$('#canvas').mouseover(function (event) {
			draw.pen.lineTo(event.offsetX,event.offsetY);
			draw.pen.stroke();
		})
	})
</script>

<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<title>geolocation</title>
	<style>
		body, html,#allmap {width: 100%;height: 95%;overflow: hidden;margin:0;font-family:"微软雅黑";}

		#r-result{width:100%;}

		#city {width:100%; font-size:14px;}
	</style>
</head>
<body>
	<div id="allmap"></div>
	<div id="r-result"></div>
	<div id="city">
		城市名: <input id="cityName" type="text" style="width:150px;height: 20px; margin-right:20px;" />
		<input type="button" value="查询" onclick="cityLocation()" style="width:100px;font-size: 18px"/>
	</div>
</body>
</html>
<script type="text/javascript" src="http://api.map.baidu.com/api?v=2.0&ak=DlBAFrcThN8g3kkbfRcfnrHS1pWUwDeS&callback=initalize"></script>
<script type="text/javascript">
	// 获取信息成功的回调函数
	function success(res){
		console.log(res);
	}
	// 获取信息失败的回调函数
	function error(res){
		console.log(res);
		switch(res.code){
			//用户选了不允许
			case 1 : alert(res.message); break;
	        //连不上GPS卫星，或者网络断了
			case 2: alert(res.message); break;
			//超时了
		    case 3: alert(res.message); break;
		    //未知错误，其实是err.code==0的时候;
		    default: alert(res.message);
		}
	}
	// 获取信息前可以按照你的需求来设置一些参数
	option = {
		enableHighAccuracy:false,
		timeOut:5000,
		maximumAge:0
	}
	if(navigator.geolocation){
		navigator.geolocation.getCurrentPosition(success,error,option)
	}
	//执行回调函数initalize
	function initalize(){
		// 创建Map实例
		var map = new BMap.Map("allmap");
		// 初始化地图,设置中心点坐标和地图级别
		var point = new BMap.Point(116.404, 39.915);
		map.centerAndZoom(point,31);

		var marker = new BMap.Marker(point);
		map.addOverlay(marker);
		marker.setAnimation(BMAP_ANIMATION_BOUNCE);
		// marker.getPosition();
		console.log(marker.getPosition())

		lng = marker.getPosition().lng;
		lat = marker.getPosition().lat;
		var sContent = "经度:" + lng + ", 纬度:" +lat;
		var infoWindow = new BMap.InfoWindow(sContent);  // 创建信息窗口对象
		map.openInfoWindow(infoWindow,point); //开启信息窗口
		// document.getElementById("r-result").innerHTML = "信息窗口的内容是：<br />" + infoWindow.getContent();


		// html页面调用js文件里的函数，写法必须为XXX = function (){}形式，其他方式写，html页面会搜索不到该函数。
		cityLocation = function () {
			var cityName = document.getElementById("cityName").value;
			if(cityName != ""){
				map.centerAndZoom(cityName,31);      // 用城市名设置地图中心点
			}
		}



		//添加地图类型控件
		map.addControl(new BMap.NavigationControl());    //地图平移缩放控件PC端默认位于地图左上方，它包含控制地图的平移和缩放的功能。移动端提供缩放控件，默认位于地图右下方。
		map.addControl(new BMap.OverviewMapControl());//添加缩略地图控件，默认位于地图右下方，是一个可折叠的缩略地图。
		map.addControl(new BMap.ScaleControl());     	//比例尺控件，默认位于地图左下方，显示地图的比例关系。
		map.addControl(new BMap.MapTypeControl());   	//地图类型控件，默认位于地图右上方。
		map.addControl(new BMap.GeolocationControl());   //定位控件，针对移动端开发，默认位于地图左下方。
		map.addControl(new BMap.CopyrightControl());     //版权控件，默认位于地图左下方。
		map.enableScrollWheelZoom(true);     //开启鼠标滚轮缩放

		//两秒后移动到上海
		// setTimeout(function(){
		// 	map.panTo(new BMap.Point(121.4309835670,31.2503572525));
		// }, 2000);
	}
</script>